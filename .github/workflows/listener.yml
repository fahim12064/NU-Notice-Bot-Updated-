name: Telegram Listener Bot

on:
  schedule:
    # ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡ß© ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶™‡¶∞ ‡¶™‡¶∞ ‡¶®‡¶§‡ßÅ‡¶® Telegram ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶¨‡ßá
    - cron: "*/3 * * * *"
  workflow_dispatch: # ‡¶ö‡¶æ‡¶á‡¶≤‡ßá ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡ßü‡¶æ‡¶≤‡¶ø ‡¶ö‡¶æ‡¶≤‡¶æ‡¶®‡ßã ‡¶Ø‡¶æ‡¶¨‡ßá

permissions:
  contents: write    # ‚úÖ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø
  actions: write     # ‚úÖ ‡¶Ö‡¶®‡ßç‡¶Ø workflow ‡¶ü‡ßç‡¶∞‡¶ø‡¶ó‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø

jobs:
  run-listener:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          persist-credentials: true  # ‚úÖ push ‡¶ï‡¶∞‡¶§‡ßá credential ‡¶ß‡¶∞‡ßá ‡¶∞‡¶æ‡¶ñ‡ßá

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests

      - name: Run Telegram Listener Bot
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          GITHUB_TOKEN: ${{ secrets.TOKE_GITHUB_BOT }}
          GITHUB_OWNER: "fahim12064"
          GITHUB_REPO: "NU-Notice-Bot-Updated-"
        run: python listener.py

      - name: Commit and push if there are changes
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add -A
          git diff --quiet && git diff --staged --quiet || (
            git commit -m "ü§ñ Auto: Listener triggered workflow or updated data" && git push
          )
